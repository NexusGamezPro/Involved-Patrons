// Progression

new entry "InvolvedHexbladePatron"
type "PassiveData"
data "DisplayName" "h8a8be88bgc57fg4cbegbdf5g6a9da982e8c9;1"
data "Description" "h9a30d1dag9929g43b6g8764g610e3fa2148d;1"
data "Icon" "PassiveFeature_ExpertDivination"
data "Properties" "Highlighted"
data "StatsFunctorContext" "OnShortRest;OnLongRest;OnCreate"
data "StatsFunctors" "IF(not context.HasContextFlag(StatsFunctorContext.OnCreate)):ApplyStatus(SELF,INVOLVED_HEXBLADE_PATRON_QUEST,100,1d4);IF(context.HasContextFlag(StatsFunctorContext.OnCreate) and not HasStatus('INVOLVED_PATRON_FAVOR_TRACKER')):ApplyStatus(SELF,INVOLVED_PATRON_FAVOR_TRACKER,100,10)"

// Quests

    // Tier 1 - Normal Reward Chances, 1d8

        // Quest 1 - Base

new entry "InvolvedHexbladePatronQuestDamageNecrotic"
type "PassiveData"
data "StatsFunctorContext" "OnDamage"
data "Conditions" "Necrotic(context.Target) and Enemy(context.Target)"
data "StatsFunctors" "ApplyStatus(SELF,INVOLVED_HEXBLADE_PATRON_REWARD,100,1d8);RemoveStatus(SELF,INVOLVED_HEXBLADE_PATRON_QUEST_DAMAGE_NECROTIC)"
data "Properties" "IsHidden"

new entry "INVOLVED_HEXBLADE_PATRON_QUEST_DAMAGE_NECROTIC"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "hea1b5aefb82a4f41a15a511cb5cd44665673;1"
data "Description" "h0adb828cgff0fg4427g84dageedcc08878c5;1"
data "DescriptionParams" "DealDamage(1,Necrotic)"
data "Icon" "PassiveFeature_ExpertDivination"
data "Passives" "InvolvedHexbladePatronQuestDamageNecrotic"
data "StackId" "PATRON_QUEST"
data "StackType" "Overwrite"
data "OnRemoveFunctors" "IF(Party()):ApplyStatus(INVOLVED_PATRON_FAVOR_TRACKER,100,Target.INVOLVED_PATRON_FAVOR_TRACKER.Duration-1)"
data "StatusGroups" "SG_RemoveOnRespec"

        // Quest 2

new entry "InvolvedHexbladePatronQuestEvocation"
type "PassiveData"
using "InvolvedHexbladePatronQuestDamageFire"
data "StatsFunctorContext" "OnCast"
data "Conditions" "IsSpell() and IsSpellSchool(SpellSchool.Evocation)"
data "StatsFunctors" "ApplyStatus(SELF,INVOLVED_HEXBLADE_PATRON_REWARD,100,1d8);RemoveStatus(SELF,INVOLVED_HEXBLADE_PATRON_QUEST_EVOCATION)"

new entry "INVOLVED_HEXBLADE_PATRON_QUEST_EVOCATION"
type "StatusData"
data "StatusType" "BOOST"
using "INVOLVED_HEXBLADE_PATRON_QUEST_DAMAGE_FIRE"
data "Description" "h6701b9ceg5045g481agb49ag8da75d8ef611;1"
data "Passives" "InvolvedHexbladePatronQuestEvocation"

    // Tier 2 - Higher Chance for better Rewards, 1d6

        // Quest 3

new entry "InvolvedHexbladePatronQuestRelease"
type "PassiveData"
using "InvolvedHexbladePatronQuestDamageNecrotic"
data "StatsFunctorContext" "OnCast"
data "Conditions" "Enemy(context.Target) and HasStatus('HEXBLADES_CURSE',context.Target) and IsKillingBlow()"
data "StatsFunctors" "ApplyStatus(SELF,INVOLVED_HEXBLADE_PATRON_REWARD,100,1d6);RemoveStatus(SELF,INVOLVED_HEXBLADE_PATRON_QUEST_RELEASE)"

new entry "INVOLVED_HEXBLADE_PATRON_QUEST_RELEASE"
type "StatusData"
data "StatusType" "BOOST"
using "INVOLVED_HEXBLADE_PATRON_QUEST_DAMAGE_NECROTIC"
data "Description" "h28b6a846f26240he8b2830732fa4e17a16afe57aedae5900787cdad848c96ff52d6e3b03b;1"
data "Passives" "InvolvedHexbladePatronQuestRelease"

    // Tier 3 - Highest Chance for better Rewards, 1d4

        // Quest 4

new entry "InvolvedHexbladePatronQuestKill"
type "PassiveData"
using "InvolvedHexbladePatronQuestDamageNecrotic"
data "StatsFunctorContext" "OnCast;OnStatusApplied"
data "Conditions" ""
data "StatsFunctors" "IF(context.HasContextFlag(StatsFunctorContext.OnCast) and Enemy(context.Target) and IsKillingBlow() and HasPactWeapon(context.Source) or HasHexbladeWeapon(context.Source)):ApplyStatus(SELF,INVOLVED_HEXBLADE_PATRON_QUEST_KILL_TRACKER,100,1);IF(context.HasContextFlag(StatsFunctorContext.OnStatusApplied) and ConditionResult(GetStatusDuration('INVOLVED_PATRON_KILL_TRACKER',context.Target) >= 2)):ApplyStatus(SELF,INVOLVED_HEXBLADE_PATRON_REWARD,100,1d4);RemoveStatus(SELF,INVOLVED_HEXBLADE_PATRON_QUEST_KILL)"

new entry "INVOLVED_HEXBLADE_PATRON_QUEST_KILL"
type "StatusData"
data "StatusType" "BOOST"
using "INVOLVED_HEXBLADE_PATRON_QUEST_DAMAGE_NECROTIC"
data "Description" "h48b605c4ecf24182b42fae4bc9be5d3a1362;1"
data "DescriptionParams" "2"
data "Passives" "InvolvedHexbladePatronQuestObliterate"

new entry "INVOLVED_HEXBLADE_PATRON_QUEST_KILL_TRACKER"
type "StatusData"
data "StatusType" "BOOST"
data "StackId" "INVOLVED_PATRON_KILL_TRACKER"
data "StackType" "Additive"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator;FreezeDuration;ApplyToDead"

// Quest Boons

    // Tier 1 - Common

new entry "INVOLVED_HEXBLADE_PATRON_BOON_SPELLSLOT"
type "StatusData"
data "StatusType" "BOOST"
data "Boosts" "IF(HasPassive('UnlockedWarlockSpellSlotLevel1', context.Source)):ActionResource(WarlockSpellSlot,1,1);IF(HasPassive('UnlockedWarlockSpellSlotLevel2', context.Source)):ActionResource(WarlockSpellSlot,1,2);IF(HasPassive('UnlockedWarlockSpellSlotLevel3', context.Source)):ActionResource(WarlockSpellSlot,1,3);IF(HasPassive('UnlockedWarlockSpellSlotLevel4', context.Source)):ActionResource(WarlockSpellSlot,1,4);IF(HasPassive('UnlockedWarlockSpellSlotLevel5', context.Source)):ActionResource(WarlockSpellSlot,1,5)"
data "StackId" "BOON_SPELLSLOT"
data "StackType" "Ignore"
data "RemoveEvents" "OnStatusApplied"
data "RemoveConditions" "HasStatus('INVOLVED_HEXBLADE_PATRON_QUEST',context.Source)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "StatusGroups" "SG_RemoveOnRespec"
data "SoundStart" "Spell_Passive_Impact_Damage_DarkOnesBlessing_L1to3"
data "ApplyEffect" "3a76f32b-1b84-4298-90c6-7e430cb9f98b"

    // Tier 2 - Rare

new entry "INVOLVED_HEXBLADE_PATRON_BOON_WEAPON"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "h031dd24cf14d49b58ce7fb99934881956d01;1"
data "Description" "h65909a266f8e470796dd3026d19d0b0fed47;1"
data "DescriptionParams" "DealDamage(LevelMapValue(HexbladeWeaponBoon), Necrotic)"
data "Icon" "Spell_Transmutation_MagicWeapon"
data "Boosts" "CharacterWeaponDamage(LevelMapValue(HexbladeWeaponBoon), Necrotic)"
data "StackId" "BOON_WEAPON"
data "StatusGroups" "SG_RemoveOnRespec"

    // Tier 3 - Rarest

new entry "INVOLVED_HEXBLADE_PATRON_BOON_UNIQUE"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "h95773471gefe4g4b78gbffdg3826c4a19617;1"
data "Description" "h6c984c10a4184662b85d709c1bcf243c1f0e;1"
data "Icon" "PassiveFeature_ExpertDivination"
data "Boosts" "Reroll(Damage,20,false)"
data "StackId" "BOON_UNIQUE"
data "StatusGroups" "SG_RemoveOnRespec"

// Technical

    // Quest handling

new entry "INVOLVED_HEXBLADE_PATRON_QUEST"
type "StatusData"
data "StatusType" "BOOST"
data "OnApplyFunctors" "ApplyStatus(INVOLVED_HEXBLADE_PATRON_QUEST_TECHNICAL,100,0)"
data "StatusPropertyFlags" "FreezeDuration;DisableOverhead;DisableCombatlog;DisablePortraitIndicator"

new entry "INVOLVED_HEXBLADE_PATRON_QUEST_TECHNICAL"
type "StatusData"
data "StatusType" "BOOST"
data "OnRemoveFunctors" "IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_QUEST',context.Target) == 1)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_QUEST_DAMAGE_NECROTIC,100,-1);IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_QUEST',context.Target) == 2)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_QUEST_RELEASE,100,-1);IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_QUEST',context.Target) == 3)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_QUEST_OBLITERATE,100,-1);IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_QUEST',context.Target) == 4)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_QUEST_SUFFER,100,-1);RemoveStatus(INVOLVED_HEXBLADE_PATRON_QUEST)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"

    // Reward handling

new entry "INVOLVED_HEXBLADE_PATRON_REWARD"
type "StatusData"
data "StatusType" "BOOST"
data "OnApplyFunctors" "ApplyStatus(INVOLVED_HEXBLADE_PATRON_REWARD_TECHNICAL,100,0);ApplyStatus(INVOLVED_PATRON_FAVOR_TRACKER,100,Target.INVOLVED_PATRON_FAVOR_TRACKER.Duration+1)"
data "StatusPropertyFlags" "FreezeDuration;DisableOverhead;DisableCombatlog;DisablePortraitIndicator"

new entry "INVOLVED_HEXBLADE_PATRON_REWARD_TECHNICAL"
type "StatusData"
data "StatusType" "BOOST"
data "OnRemoveFunctors" "IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_REWARD',context.Target) == 1) and HasStatus('INVOLVED_HEXBLADE_PATRON_BOON_UNIQUE',context.Source)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_BOON_SPELLSLOT,100,-1);IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_REWARD',context.Target) == 1) and not HasStatus('INVOLVED_HEXBLADE_PATRON_BOON_UNIQUE',context.Source)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_BOON_UNIQUE,100,-1);IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_REWARD',context.Target) == 2) and HasStatus('INVOLVED_HEXBLADE_PATRON_BOON_WEAPON',context.Source)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_BOON_SPELLSLOT,100,-1);IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_REWARD',context.Target) == 2) and not HasStatus('INVOLVED_HEXBLADE_PATRON_BOON_WEAPON',context.Source)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_BOON_WEAPON,100,-1);IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_REWARD',context.Target) == 3) and HasStatus('INVOLVED_HEXBLADE_PATRON_BOON_WEAPON',context.Source)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_BOON_SPELLSLOT,100,-1);IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_REWARD',context.Target) == 3) and not HasStatus('INVOLVED_HEXBLADE_PATRON_BOON_WEAPON',context.Source)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_BOON_WEAPON,100,-1);IF(ConditionResult(GetStatusDuration('INVOLVED_HEXBLADE_PATRON_REWARD',context.Target) >= 4)):ApplyStatus(INVOLVED_HEXBLADE_PATRON_BOON_SPELLSLOT,100,-1);RemoveStatus(INVOLVED_HEXBLADE_PATRON_REWARD)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"